"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Redis = void 0;
const redis_1 = require("redis");
function Redis(opts) {
    let client;
    if ("client" in opts)
        client = opts.client;
    else
        client = (0, redis_1.createClient)({ ...opts.config, url: opts.url });
    const connection = client.connect();
    const prefix = opts.prefix || "telegraf:";
    return {
        async get(key) {
            await connection;
            const value = await client.get(prefix + key);
            return value ? JSON.parse(value) : undefined;
        },
        async set(key, session) {
            await connection;
            return await client.set(prefix + key, JSON.stringify(session));
        },
        async delete(key) {
            await connection;
            return await client.del(prefix + key);
        },
    };
}
exports.Redis = Redis;
